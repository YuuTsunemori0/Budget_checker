<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Voyage</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>üí∞ Budget Voyage</h1>

        <div class="grid-container">
            <!-- üìã Formulaire Ajout D√©pense -->
            <div class="form-section">
                <h2>‚ûï Ajouter une D√©pense</h2>
                <input type="text" id="libelle" placeholder="Libell√©">
                <p class="error" id="errorLibelle"></p>

                <input type="text" id="montant" placeholder="Montant">
                <p class="error" id="errorMontant"></p>

                <select id="categorie">
                    <option value="" disabled selected>Type de d√©pense</option>
                </select>
                <p class="error" id="errorCategorie"></p>

                <button onclick="ajouterDepense()">Ajouter</button>
                <button onclick="reinitialiserDepenses()">R√©initialiser</button>
            </div>

            <!-- üìã Affichage des D√©penses -->
            <div class="expenses-section">
                <h2>üìú Liste des D√©penses</h2>
                <ul id="listeDepenses"></ul>
                <p>Total : <span id="total">0</span> ‚Ç¨</p>
            </div>

            <!-- üìå Section Budget & Gestion des Cat√©gories -->
            <div class="budget-section">
                <h2>üí∞ Budget</h2>
                <label for="budgetTotal">Budget Total :</label>
                <input type="text" id="budgetTotal" placeholder="D√©finir un budget total">
                <p>Budget restant : <span id="budgetRestant">0</span> ‚Ç¨</p>

                <h2>üé≠ G√©rer les Cat√©gories</h2>
                <button onclick="ouvrirGestionCategories()">üõ†Ô∏è G√©rer</button>

                <div id="modalCategories" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="fermerGestionCategories()">&times;</span>
                        <h3>Ajouter une Cat√©gorie</h3>
                        <input type="text" id="nouvelleCategorie" placeholder="Nom">
                        <input type="text" id="emojiCategorie" placeholder="Emoji (ex: üè°)">
                        <button onclick="ajouterCategorie()">Ajouter</button>
                        <h3>üìã Liste des Cat√©gories</h3>
                        <ul id="listeCategories"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- üî• Firebase Configuration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, Timestamp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCy8_7PjzpZi4I75dtBapp42OpDbd1TYOw",
            authDomain: "budget-checker.firebaseapp.com",
            projectId: "budget-checker",
            storageBucket: "budget-checker.firebasestorage.app",
            messagingSenderId: "190621017450",
            appId: "1:190621017450:web:1491f535d6c5913b22b113",
            measurementId: "G-R10JVNYPZ1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function ajouterDepense() {
            const libelle = document.getElementById("libelle").value.trim();
            const montantStr = document.getElementById("montant").value.trim();
            const categorie = document.getElementById("categorie").value;

            if (!libelle || !montantStr || !categorie) {
                alert("Veuillez remplir tous les champs !");
                return;
            }

            const montant = parseFloat(montantStr.replace(",", "."));
            if (isNaN(montant) || montant <= 0) {
                alert("Veuillez entrer un montant valide !");
                return;
            }

            try {
                await addDoc(collection(db, "depenses"), {
                    libelle,
                    montant,
                    categorie,
                    date: Timestamp.now()
                });
                afficherDepenses();
            } catch (error) {
                console.error("‚ùå Erreur lors de l'ajout :", error);
            }
        }

        async function afficherDepenses() {
            const liste = document.getElementById("listeDepenses");
            liste.innerHTML = "";
            let total = 0;

            const querySnapshot = await getDocs(collection(db, "depenses"));
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                total += data.montant;
                const li = document.createElement("li");
                li.textContent = `${data.libelle} - ${data.montant}‚Ç¨ (${data.categorie})`;
                liste.appendChild(li);
            });

            document.getElementById("total").textContent = total;
        }

        afficherDepenses();
    </script>

    <!-- Inclusion des scripts -->
    <script src="scripts/main.js"></script>
    <script src="scripts/budget.js"></script>
    <script src="scripts/expenses.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/categories.js"></script>
</body>
</html>
