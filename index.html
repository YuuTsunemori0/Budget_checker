<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Voyage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 400px;
            margin: auto;
        }
        input, button, select {
            display: block;
            margin: 10px 0;
            width: 100%;
            padding: 10px;
        }
        #total, .subtotal {
            font-weight: bold;
        }
        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .category-container {
            margin-top: 10px;
        }
        .category-header {
            cursor: pointer;
            font-weight: bold;
        }
        .category-details {
            display: none;
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Calculateur de Budget</h2>
        <label for="budgetTotal">Budget Total :</label>
        <input type="text" id="budgetTotal" placeholder="Définir un budget total" oninput="formatMontant()">
        <p>Budget restant : <span id="budgetRestant">0</span> €</p>
        <input type="text" id="libelle" placeholder="Libellé">
        <input type="text" id="montant" placeholder="Montant" oninput="formatMontant()">
        <select id="categorie">
            <option value="" disabled selected>Type de dépense</option>
            <option value="Logement">🏠 Logement</option>
            <option value="Transport">🚕 Transport</option>
            <option value="Nourriture">🍔 Nourriture</option>
            <option value="Loisirs">🎟️ Loisirs</option>
        </select>
        <button onclick="ajouterDepense()">Ajouter</button>
        <button onclick="reinitialiserDepenses()">Réinitialiser</button>
        <p>Total : <span id="total">0</span> €</p>
        
        <div id="categories"></div>
    </div>

    <script>
        let total = 0;
        let budgetTotal = 0;
        let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
        let subtotals = { Logement: 0, Transport: 0, Nourriture: 0, Loisirs: 0 };

        function formatMontant() {
            document.querySelectorAll("#montant, #budgetTotal").forEach(input => {
                let value = input.value.replace(/[^0-9,.]/g, "");
                input.value = new Intl.NumberFormat("fr-FR", { minimumFractionDigits: 2 }).format(value);
            });
        }

        function ajouterDepense() {
            const libelle = document.getElementById("libelle").value;
            const montant = parseFloat(document.getElementById("montant").value.replace(/\s/g, "").replace(",", "."));
            const categorie = document.getElementById("categorie").value;

            if (libelle && categorie && !isNaN(montant) && montant > 0) {
                expenses.push({ libelle, montant, categorie });
                localStorage.setItem("expenses", JSON.stringify(expenses));
                afficherDepenses();
            }
            
            document.getElementById("libelle").value = "";
            document.getElementById("montant").value = "";
            document.getElementById("categorie").selectedIndex = 0;
        }

        function afficherDepenses() {
            const categoriesContainer = document.getElementById("categories");
            categoriesContainer.innerHTML = "";

            expenses.forEach((expense, index) => {
                const expenseElement = document.createElement("p");
                expenseElement.innerHTML = `${expense.libelle} : ${new Intl.NumberFormat("fr-FR").format(expense.montant)} € ` +
                    `<button onclick="modifierDepense(${index})">📝</button>` +
                    `<button onclick="supprimerDepense(${index})">🗑️</button>`;
                categoriesContainer.appendChild(expenseElement);
            });
        }

        function modifierDepense(index) {
            const newLibelle = prompt("Modifier le libellé :", expenses[index].libelle);
            const newMontant = parseFloat(prompt("Modifier le montant :", expenses[index].montant).replace(",", "."));
            
            if (newLibelle && !isNaN(newMontant) && newMontant > 0) {
                expenses[index].libelle = newLibelle;
                expenses[index].montant = newMontant;
                localStorage.setItem("expenses", JSON.stringify(expenses));
                afficherDepenses();
            }
        }

        function supprimerDepense(index) {
            expenses.splice(index, 1);
            localStorage.setItem("expenses", JSON.stringify(expenses));
            afficherDepenses();
        }

        function reinitialiserDepenses() {
            if (confirm("Voulez-vous vraiment réinitialiser toutes les dépenses ?")) {
                expenses = [];
                localStorage.removeItem("expenses");
                afficherDepenses();
            }
        }

        document.addEventListener("DOMContentLoaded", afficherDepenses);
    </script>
</body>
</html>
