<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Voyage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 400px;
            margin: auto;
        }
        input, button, select {
            display: block;
            margin: 10px 0;
            width: 100%;
            padding: 10px;
        }
        #total, .subtotal {
            font-weight: bold;
        }
        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Calculateur de Budget</h2>
        <label for="budgetTotal">Budget Total :</label>
        <input type="number" id="budgetTotal" placeholder="Définir un budget total">
        <p>Budget restant : <span id="budgetRestant">0</span> €</p>
        <input type="text" id="libelle" placeholder="Libellé">
        <input type="text" id="montant" placeholder="Montant" oninput="formatMontant()">
        <select id="categorie">
            <option value="Logement">🏠 Logement</option>
            <option value="Transport">🚕 Transport</option>
            <option value="Nourriture">🍔 Nourriture</option>
            <option value="Loisirs">🎟️ Loisirs</option>
        </select>
        <button onclick="ajouterDepense()">Ajouter</button>
        <ul id="liste"></ul>
        <p>Total : <span id="total">0</span> €</p>
        <p class="subtotal">🏠 Logement : <span id="totalLogement">0</span> €</p>
        <p class="subtotal">🚕 Transport : <span id="totalTransport">0</span> €</p>
        <p class="subtotal">🍔 Nourriture : <span id="totalNourriture">0</span> €</p>
        <p class="subtotal">🎟️ Loisirs : <span id="totalLoisirs">0</span> €</p>
        <button onclick="convertirDevise()">Convertir en JPY</button>
    </div>

    <script>
        let total = 0;
        let budgetTotal = 0;
        let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
        let subtotals = { Logement: 0, Transport: 0, Nourriture: 0, Loisirs: 0 };

        function formatMontant() {
            let input = document.getElementById("montant");
            let value = input.value.replace(/\D/g, "");
            input.value = new Intl.NumberFormat("fr-FR").format(value);
        }

        function ajouterDepense() {
            const libelle = document.getElementById("libelle").value;
            const montant = parseFloat(document.getElementById("montant").value.replace(/\s/g, ""));
            const categorie = document.getElementById("categorie").value;

            if (libelle && !isNaN(montant) && montant > 0) {
                expenses.push({ libelle, montant, categorie });
                subtotals[categorie] += montant;
                total += montant;
                localStorage.setItem("expenses", JSON.stringify(expenses));
                afficherDepenses();
            }
        }

        function afficherDepenses() {
            const liste = document.getElementById("liste");
            liste.innerHTML = "";
            total = 0;
            subtotals = { Logement: 0, Transport: 0, Nourriture: 0, Loisirs: 0 };

            expenses.forEach((expense, index) => {
                const element = document.createElement("li");
                element.classList.add("expense-item");
                element.innerHTML = `${expense.libelle} (${expense.categorie}) : ${new Intl.NumberFormat("fr-FR").format(expense.montant)} € <button onclick="supprimerDepense(${index})">🗑️</button>`;
                liste.appendChild(element);
                total += expense.montant;
                subtotals[expense.categorie] += expense.montant;
            });

            document.getElementById("total").textContent = new Intl.NumberFormat("fr-FR").format(total);
            document.getElementById("totalLogement").textContent = new Intl.NumberFormat("fr-FR").format(subtotals.Logement);
            document.getElementById("totalTransport").textContent = new Intl.NumberFormat("fr-FR").format(subtotals.Transport);
            document.getElementById("totalNourriture").textContent = new Intl.NumberFormat("fr-FR").format(subtotals.Nourriture);
            document.getElementById("totalLoisirs").textContent = new Intl.NumberFormat("fr-FR").format(subtotals.Loisirs);
        }

        function supprimerDepense(index) {
            let deleted = expenses.splice(index, 1)[0];
            total -= deleted.montant;
            subtotals[deleted.categorie] -= deleted.montant;
            localStorage.setItem("expenses", JSON.stringify(expenses));
            afficherDepenses();
        }

        document.addEventListener("DOMContentLoaded", afficherDepenses);
    </script>
</body>
</html>
