<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Voyage</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ’° Budget Voyage</h1>

        <!-- ğŸ“Œ Section Budget -->
        <div class="budget-section">
            <label for="budgetTotal">Budget Total :</label>
            <input type="text" id="budgetTotal" placeholder="DÃ©finir un budget total">
            <p>Budget restant : <span id="budgetRestant">0</span> â‚¬</p>
        </div>

        <div class="main-content">
            <!-- ğŸ“‹ Formulaire Ajout DÃ©pense -->
            <div class="form-section">
                <h2>â• Ajouter une DÃ©pense</h2>
                <input type="text" id="libelle" placeholder="LibellÃ©">
                <p class="error" id="errorLibelle"></p>

                <input type="text" id="montant" placeholder="Montant">
                <p class="error" id="errorMontant"></p>

                <select id="categorie">
                    <option value="" disabled selected>Type de dÃ©pense</option>
                </select>
                <p class="error" id="errorCategorie"></p>

                <button onclick="ajouterDepense()">Ajouter</button>
                <button onclick="reinitialiserDepenses()">RÃ©initialiser</button>
            </div>

            <!-- ğŸ“‹ Affichage des DÃ©penses -->
            <div class="expenses-section">
                <h2>ğŸ“œ Liste des DÃ©penses</h2>
                <ul id="listeDepenses"></ul>
                <p>Total : <span id="total">0</span> â‚¬</p>
            </div>

            <!-- ğŸ­ Gestion des CatÃ©gories -->
            <div class="categories-section">
                <h2>ğŸ­ GÃ©rer les CatÃ©gories</h2>
                <button onclick="ouvrirGestionCategories()">ğŸ› ï¸ GÃ©rer</button>

                <div id="modalCategories" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="fermerGestionCategories()">&times;</span>
                        <h3>Ajouter une CatÃ©gorie</h3>
                        <input type="text" id="nouvelleCategorie" placeholder="Nom">
                        <input type="text" id="emojiCategorie" placeholder="Emoji (ex: ğŸ¡)">
                        <button onclick="ajouterCategorie()">Ajouter</button>
                        <h3>ğŸ“‹ Liste des CatÃ©gories</h3>
                        <ul id="listeCategories"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”¥ Firebase Configuration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, Timestamp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-firestore.js";

        // ğŸ”¥ Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCy8_7PjzpZi4I75dtBapp42OpDbd1TYOw",
            authDomain: "budget-checker.firebaseapp.com",
            projectId: "budget-checker",
            storageBucket: "budget-checker.firebasestorage.app",
            messagingSenderId: "190621017450",
            appId: "1:190621017450:web:1491f535d6c5913b22b113",
            measurementId: "G-R10JVNYPZ1"
        };

        // ğŸ”¥ Initialiser Firebase & Firestore
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // ğŸ“Œ Fonction pour ajouter une dÃ©pense dans Firestore
        async function ajouterDepense() {
            const libelle = document.getElementById("libelle").value.trim();
            const montantStr = document.getElementById("montant").value.trim();
            const categorie = document.getElementById("categorie").value;

            if (!libelle || !montantStr || !categorie) {
                alert("Veuillez remplir tous les champs !");
                return;
            }

            const montant = parseFloat(montantStr.replace(",", "."));
            if (isNaN(montant) || montant <= 0) {
                alert("Veuillez entrer un montant valide !");
                return;
            }

            try {
                await addDoc(collection(db, "depenses"), {
                    libelle,
                    montant,
                    categorie,
                    date: Timestamp.now()
                });
                console.log("âœ… DÃ©pense ajoutÃ©e avec succÃ¨s !");
                afficherDepenses();
            } catch (error) {
                console.error("âŒ Erreur lors de l'ajout :", error);
            }
        }

        // ğŸ“Œ Fonction pour rÃ©cupÃ©rer et afficher les dÃ©penses
        async function afficherDepenses() {
            const liste = document.getElementById("listeDepenses");
            liste.innerHTML = "";
            let total = 0;

            const querySnapshot = await getDocs(collection(db, "depenses"));
            querySnapshot.forEach((doc) => {
                const data = doc.data();
                total += data.montant;
                const li = document.createElement("li");
                li.textContent = `${data.libelle} - ${data.montant}â‚¬ (${data.categorie})`;
                liste.appendChild(li);
            });

            document.getElementById("total").textContent = total;
        }

        // ğŸ“Œ Chargement des dÃ©penses au dÃ©marrage
        afficherDepenses();
    </script>

    <!-- Inclusion des scripts -->
    <script src="scripts/main.js"></script>
    <script src="scripts/budget.js"></script>
    <script src="scripts/expenses.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/categories.js"></script>
</body>
</html>
